# 测试文档索引

> **目标**：提供完整的测试文档导航
> 
> **更新时间**：2025-12-31

---

## 📚 文档列表

### 1. [测试框架集成指南](./测试框架集成指南.md)

**内容**：
- ✅ 常用开源测试框架对比（Google Test、Catch2、Boost.Test、doctest）
- ✅ 为什么选择 Google Test + Google Mock
- ✅ 三种集成方式详解（FetchContent、系统安装、Git Submodule）
- ✅ 我们项目的推荐方案和集成步骤
- ✅ 测试金字塔原则和测试重点
- ✅ 运行测试的各种命令
- ✅ 测试覆盖率统计（gcov/lcov/gcovr）
- ✅ 生成测试报告网页
- ✅ CI/CD 集成（GitHub Actions + Codecov）
- ✅ 测试覆盖率目标

**适用场景**：
- 🎯 首次配置测试框架
- 🎯 了解如何运行测试
- 🎯 学习如何统计覆盖率
- 🎯 配置 CI/CD

### 2. [单元测试用例设计](./单元测试用例设计.md)

**内容**：
- ✅ MagnetUriParser 测试用例（17+ 个）
  - 功能测试（标准链接、多 tracker、URL 编码）
  - 边界条件测试（最小链接、超长链接、空字符串）
  - 错误处理测试（缺少前缀、无效 hash、无效编码）
  - 特殊情况测试（重复参数、参数顺序、未知参数）
  - 性能测试
- ✅ Bencode 测试用例（26+ 个）
  - 整数编解码（正数、零、负数、大整数）
  - 字符串编解码（普通、空、特殊字符、二进制、超长）
  - 列表编解码（空、整数、字符串、混合）
  - 字典编解码（空、单键、多键、排序验证）
  - 嵌套结构测试
  - 错误处理测试
  - 往返测试（Round-trip）
  - 性能测试
- ✅ UdpClient 测试用例（15+ 个）
  - 基本功能测试
  - 统计信息测试
  - Mock 测试示例
- ✅ 测试覆盖率目标表格

**适用场景**：
- 🎯 编写测试用例时参考
- 🎯 了解测试重点
- 🎯 学习测试用例设计方法

---

## 🎯 快速开始

### 第一次使用

1. **阅读**：[测试框架集成指南](./测试框架集成指南.md) 第 1-2 章
2. **配置**：按照指南配置 CMake 和测试目录
3. **参考**：[单元测试用例设计](./单元测试用例设计.md) 编写测试
4. **运行**：按照指南第 4 章运行测试

### 编写测试用例

1. **参考**：[单元测试用例设计](./单元测试用例设计.md) 中的示例
2. **遵循**：AAA 模式（Arrange、Act、Assert）
3. **覆盖**：功能、边界、错误、性能
4. **命名**：使用清晰的测试名称

### 运行测试

```bash
# 配置
cmake -B build -DCMAKE_BUILD_TYPE=Debug -DBUILD_TESTS=ON

# 编译
cmake --build build

# 运行所有测试
cd build && ctest

# 运行特定测试
./tests/magnet_tests --gtest_filter=BencodeTest.*
```

### 查看覆盖率

```bash
# 启用覆盖率编译
cmake -B build -DCMAKE_BUILD_TYPE=Debug -DBUILD_TESTS=ON -DENABLE_COVERAGE=ON

# 编译和运行测试
cmake --build build
cd build && ctest

# 生成覆盖率报告
gcovr --root .. --html --html-details -o coverage.html

# 查看报告
xdg-open coverage.html
```

---

## 📊 测试覆盖率目标

| 模块 | 行覆盖率 | 分支覆盖率 | 测试用例数 | 优先级 |
|------|---------|-----------|-----------|--------|
| Bencode | 95%+ | 90%+ | 26+ | 🔴 高 |
| MagnetUriParser | 95%+ | 90%+ | 17+ | 🔴 高 |
| UdpClient | 85%+ | 80%+ | 15+ | 🟡 中 |
| DHTClient | 90%+ | 85%+ | 25+ | 🔴 高 |
| **整体项目** | 85%+ | 80%+ | 150+ | 🔴 高 |

---

## 🔗 相关文档

### 设计文档

- [Bencode 设计文档](../协议设计/Bencode设计文档.md)
- [UdpClient 设计文档](../网络设计/UdpClient设计文档.md)
- [磁力链接下载完整流程](../../docs/design/磁力链接下载完整流程.md)

### 开发文档

- [开发策略调整](../开发策略调整.md)
- [下一步模块开发计划](../下一步模块开发计划.md)
- [开源项目参考](../../docs/design/开源项目参考.md)

---

## 💡 最佳实践

### 测试编写

1. ✅ **先写测试，后写实现**（TDD）
2. ✅ **每个功能至少 3 个测试**：正常、边界、错误
3. ✅ **使用 Mock 隔离依赖**
4. ✅ **测试应该快速运行**（< 1 秒）
5. ✅ **测试应该独立**（不依赖其他测试）

### 测试命名

```cpp
// ✅ 好的命名
TEST(BencodeTest, EncodePositiveInteger)
TEST(MagnetParserTest, ParseStandardMagnetUri)

// ❌ 差的命名
TEST(test_bencode, test1)
TEST(parser, test)
```

### 测试结构（AAA 模式）

```cpp
TEST(ExampleTest, TestCase) {
    // Arrange（准备）：设置测试数据和环境
    BencodeValue value(42);
    
    // Act（执行）：执行被测试的操作
    std::string encoded = Bencode::encode(value);
    
    // Assert（断言）：验证结果
    EXPECT_EQ(encoded, "i42e");
}
```

---

## 📝 待办事项

### 短期（本周）

- [ ] 配置 Google Test（FetchContent 方式）
- [ ] 创建测试目录结构
- [ ] 编写 Bencode 测试用例
- [ ] 实现 Bencode 编解码器
- [ ] 运行测试并达到 95% 覆盖率

### 中期（本月）

- [ ] 编写 MagnetUriParser 测试用例
- [ ] 实现 MagnetUriParser
- [ ] 编写 UdpClient 测试用例
- [ ] 实现 UdpClient
- [ ] 配置 CI/CD（GitHub Actions）

### 长期（本季度）

- [ ] 编写 DHTClient 测试用例
- [ ] 实现 DHTClient
- [ ] 整体覆盖率达到 85%+
- [ ] 集成 Codecov
- [ ] 生成测试报告网页

---

## 🔧 工具和资源

### 工具

- [Google Test](https://github.com/google/googletest) - 测试框架
- [lcov](http://ltp.sourceforge.net/coverage/lcov.php) - 覆盖率工具
- [gcovr](https://gcovr.com/) - 覆盖率报告生成器
- [Codecov](https://codecov.io/) - 在线覆盖率服务

### 文档

- [Google Test 官方文档](https://google.github.io/googletest/)
- [Google Mock 官方文档](https://google.github.io/googletest/gmock_for_dummies.html)
- [CMake 测试文档](https://cmake.org/cmake/help/latest/manual/ctest.1.html)

---


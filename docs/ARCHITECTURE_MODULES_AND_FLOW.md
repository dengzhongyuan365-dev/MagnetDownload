# MagnetDownload æ¶æ„ï¼šæ¨¡å—ç»„æˆä¸åä½œæµç¨‹

> **æ ¸å¿ƒå…³æ³¨**ï¼šç³»ç»Ÿæœ‰å“ªäº›æ¨¡å—ï¼Ÿå®ƒä»¬å¦‚ä½•åä½œå®Œæˆç£åŠ›é“¾æ¥ä¸‹è½½ï¼Ÿ

---

## ğŸ“¦ ä¸€ã€æ ¸å¿ƒæ¨¡å—å…¨æ™¯å›¾

### 1.1 æ¨¡å—åˆ†å±‚è§†å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åº”ç”¨å±‚ (Application)                    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ CLI Interfaceâ”‚  â”‚DownloadManagerâ”‚  â”‚ProgressTrackerâ”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ ä½¿ç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä¸šåŠ¡å±‚ (Business)                       â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚MagnetParser  â”‚  â”‚  DHTClient   â”‚  â”‚ PeerManager  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚PieceManager  â”‚  â”‚DataVerifier  â”‚  â”‚ FileWriter   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ ä½¿ç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç½‘ç»œå±‚ (Network)                        â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  UDPClient   â”‚  â”‚  TCPClient   â”‚  â”‚MessageCodec  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚RoutingTable  â”‚  â”‚ConnectionPoolâ”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ ä½¿ç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åŸºç¡€å±‚ (Foundation)                     â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚EventLoopMgr  â”‚  â”‚TaskScheduler â”‚  â”‚    Logger    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚    Config    â”‚  â”‚MemoryManager â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ åŸºäº
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Asio äº‹ä»¶å¾ªç¯æ ¸å¿ƒ                          â”‚
â”‚                   io_context + å¼‚æ­¥ I/O                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ¨¡å—æ¸…å•

| å±‚æ¬¡ | æ¨¡å—å | èŒè´£ | çŠ¶æ€ |
|------|--------|------|------|
| **åŸºç¡€å±‚** | EventLoopManager | ç®¡ç†å¤šçº¿ç¨‹äº‹ä»¶å¾ªç¯æ±  | âœ… å·²å®ç° |
| | TaskScheduler | ä¼˜å…ˆçº§ä»»åŠ¡è°ƒåº¦ | âš ï¸ å¾…å®Œæˆ |
| | Logger | å¼‚æ­¥æ—¥å¿—ç³»ç»Ÿ | âš ï¸ å¾…å®Œæˆ |
| | Config | é…ç½®ç®¡ç† | âŒ æœªå¼€å§‹ |
| **ç½‘ç»œå±‚** | UDPClient | UDP é€šä¿¡ | âŒ æœªå¼€å§‹ |
| | TCPClient | TCP è¿æ¥ç®¡ç† | âŒ æœªå¼€å§‹ |
| | MessageCodec | æ¶ˆæ¯ç¼–è§£ç  | âŒ æœªå¼€å§‹ |
| | RoutingTable | DHT è·¯ç”±è¡¨ | âŒ æœªå¼€å§‹ |
| | ConnectionPool | è¿æ¥æ± ç®¡ç† | âŒ æœªå¼€å§‹ |
| **ä¸šåŠ¡å±‚** | MagnetParser | ç£åŠ›é“¾æ¥è§£æ | âŒ æœªå¼€å§‹ |
| | DHTClient | DHT ç½‘ç»œå®¢æˆ·ç«¯ | âŒ æœªå¼€å§‹ |
| | PeerManager | Peer è¿æ¥ç®¡ç† | âŒ æœªå¼€å§‹ |
| | PieceManager | åˆ†ç‰‡ç®¡ç† | âŒ æœªå¼€å§‹ |
| | DataVerifier | æ•°æ®æ ¡éªŒ | âŒ æœªå¼€å§‹ |
| | FileWriter | æ–‡ä»¶å†™å…¥ | âŒ æœªå¼€å§‹ |
| **åº”ç”¨å±‚** | DownloadManager | ä¸‹è½½ä»»åŠ¡ç®¡ç† | âŒ æœªå¼€å§‹ |
| | CLI Interface | å‘½ä»¤è¡Œç•Œé¢ | âŒ æœªå¼€å§‹ |

---

## ğŸ”„ äºŒã€å®Œæ•´ä¸‹è½½æµç¨‹ï¼šæ¨¡å—åä½œ

### 2.1 ä»ç£åŠ›é“¾æ¥åˆ°æ–‡ä»¶ä¸‹è½½çš„å®Œæ•´æµç¨‹

```
ç”¨æˆ·è¾“å…¥ç£åŠ›é“¾æ¥
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ 1ï¼šè§£æç£åŠ›é“¾æ¥                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
[CLI Interface] æ¥æ”¶ç”¨æˆ·è¾“å…¥
    â†“
[MagnetParser] è§£æ URI
    â”œâ”€ æå– InfoHash (SHA-1)
    â”œâ”€ æå–æ–‡ä»¶å (dn)
    â”œâ”€ æå– Tracker åˆ—è¡¨ (tr)
    â””â”€ æå–æ–‡ä»¶å¤§å° (xl)
    â†“
è¿”å› MagnetInfo ç»“æ„
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ 2ï¼šDHT ç½‘ç»œæŸ¥æ‰¾ Peer                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
[DownloadManager] åˆ›å»ºä¸‹è½½ä»»åŠ¡
    â†“
[DHTClient] å¯åŠ¨ Peer å‘ç°
    â”œâ”€ [UDPClient] è¿æ¥å¼•å¯¼èŠ‚ç‚¹
    â”œâ”€ [RoutingTable] ç»´æŠ¤èŠ‚ç‚¹è·¯ç”±è¡¨
    â”œâ”€ å‘é€ find_node æŸ¥è¯¢
    â”œâ”€ å‘é€ get_peers æŸ¥è¯¢
    â””â”€ æ”¶é›† Peer åˆ—è¡¨
    â†“
è¿”å› Peer åˆ—è¡¨ (IP:Port)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ 3ï¼šè¿æ¥ Peer å¹¶è·å–å…ƒæ•°æ®                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
[PeerManager] ç®¡ç† Peer è¿æ¥
    â†“
å¯¹æ¯ä¸ª Peer:
    [TCPClient] å»ºç«‹ TCP è¿æ¥
        â†“
    [PeerConnection] æ‰§è¡Œæ¡æ‰‹
        â”œâ”€ å‘é€åè®®æ ‡è¯†
        â”œâ”€ å‘é€ InfoHash
        â”œâ”€ å‘é€ PeerID
        â””â”€ æ¥æ”¶å¯¹æ–¹ä¿¡æ¯
        â†“
    [MetadataFetcher] è¯·æ±‚å…ƒæ•°æ®
        â”œâ”€ ä½¿ç”¨æ‰©å±•åè®® (BEP 9)
        â”œâ”€ è¯·æ±‚ metadata åˆ†ç‰‡
        â””â”€ ç»„è£…å®Œæ•´å…ƒæ•°æ®
        â†“
    [BencodeParser] è§£æå…ƒæ•°æ®
        â”œâ”€ æ–‡ä»¶åˆ—è¡¨
        â”œâ”€ åˆ†ç‰‡å¤§å°
        â”œâ”€ åˆ†ç‰‡å“ˆå¸Œ
        â””â”€ æ–‡ä»¶ç»“æ„
    â†“
è¿”å› TorrentMetadata
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ 4ï¼šä¸‹è½½æ–‡ä»¶æ•°æ®                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
[PieceManager] åˆå§‹åŒ–åˆ†ç‰‡ç®¡ç†
    â”œâ”€ åˆ›å»ºåˆ†ç‰‡ä½å›¾ (Bitfield)
    â”œâ”€ æ ‡è®°æœªä¸‹è½½çš„åˆ†ç‰‡
    â””â”€ é€‰æ‹©ä¸‹è½½ç­–ç•¥
    â†“
[DownloadScheduler] è°ƒåº¦ä¸‹è½½ä»»åŠ¡
    â†“
å¯¹æ¯ä¸ªæ´»è·ƒçš„ Peer:
    [PeerConnection] è¯·æ±‚åˆ†ç‰‡
        â”œâ”€ å‘é€ interested æ¶ˆæ¯
        â”œâ”€ ç­‰å¾… unchoke æ¶ˆæ¯
        â”œâ”€ å‘é€ request æ¶ˆæ¯
        â””â”€ æ¥æ”¶ piece æ¶ˆæ¯
        â†“
    [DataVerifier] æ ¡éªŒæ•°æ®
        â”œâ”€ è®¡ç®— SHA-1 å“ˆå¸Œ
        â”œâ”€ ä¸å…ƒæ•°æ®å¯¹æ¯”
        â””â”€ æ ‡è®°åˆ†ç‰‡çŠ¶æ€
        â†“
    [FileWriter] å†™å…¥ç£ç›˜
        â”œâ”€ æ˜ å°„åˆ†ç‰‡åˆ°æ–‡ä»¶
        â”œâ”€ è®¡ç®—æ–‡ä»¶åç§»
        â””â”€ å¼‚æ­¥å†™å…¥
    â†“
[ProgressTracker] æ›´æ–°è¿›åº¦
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ 5ï¼šå®Œæˆä¸‹è½½                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
[PieceManager] æ£€æŸ¥æ‰€æœ‰åˆ†ç‰‡å®Œæˆ
    â†“
[DataVerifier] æœ€ç»ˆæ ¡éªŒ
    â†“
[DownloadManager] æ ‡è®°ä»»åŠ¡å®Œæˆ
    â†“
[CLI Interface] é€šçŸ¥ç”¨æˆ·
```

### 2.2 å…³é”®äº¤äº’æ—¶åºå›¾

```
ç”¨æˆ·    CLI    DownloadMgr  MagnetParser  DHTClient  PeerMgr  FileWriter
 â”‚       â”‚          â”‚            â”‚            â”‚         â”‚         â”‚
 â”‚â”€â”€URIâ”€â”€>â”‚          â”‚            â”‚            â”‚         â”‚         â”‚
 â”‚       â”‚â”€â”€parseâ”€â”€>â”‚            â”‚            â”‚         â”‚         â”‚
 â”‚       â”‚          â”‚â”€â”€extractâ”€â”€>â”‚            â”‚         â”‚         â”‚
 â”‚       â”‚          â”‚<â”€â”€Infoâ”€â”€â”€â”€â”€â”‚            â”‚         â”‚         â”‚
 â”‚       â”‚<â”€Infoâ”€â”€â”€â”€â”‚            â”‚            â”‚         â”‚         â”‚
 â”‚       â”‚          â”‚                         â”‚         â”‚         â”‚
 â”‚       â”‚          â”‚â”€â”€findPeersâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚         â”‚         â”‚
 â”‚       â”‚          â”‚                         â”‚         â”‚         â”‚
 â”‚       â”‚          â”‚                    [DHTæŸ¥è¯¢]      â”‚         â”‚
 â”‚       â”‚          â”‚                         â”‚         â”‚         â”‚
 â”‚       â”‚          â”‚<â”€â”€Peersâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚         â”‚         â”‚
 â”‚       â”‚          â”‚                         â”‚         â”‚         â”‚
 â”‚       â”‚          â”‚â”€â”€connectâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚         â”‚
 â”‚       â”‚          â”‚                         â”‚         â”‚         â”‚
 â”‚       â”‚          â”‚                         â”‚    [æ¡æ‰‹+å…ƒæ•°æ®]  â”‚
 â”‚       â”‚          â”‚                         â”‚         â”‚         â”‚
 â”‚       â”‚          â”‚<â”€â”€Metadataâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚         â”‚
 â”‚       â”‚          â”‚                         â”‚         â”‚         â”‚
 â”‚       â”‚          â”‚â”€â”€downloadâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚         â”‚
 â”‚       â”‚          â”‚                         â”‚         â”‚         â”‚
 â”‚       â”‚          â”‚                         â”‚    [è¯·æ±‚åˆ†ç‰‡]     â”‚
 â”‚       â”‚          â”‚                         â”‚         â”‚         â”‚
 â”‚       â”‚          â”‚                         â”‚    [æ¥æ”¶æ•°æ®]     â”‚
 â”‚       â”‚          â”‚                         â”‚         â”‚         â”‚
 â”‚       â”‚          â”‚                         â”‚         â”‚â”€â”€writeâ”€>â”‚
 â”‚       â”‚          â”‚                         â”‚         â”‚         â”‚
 â”‚       â”‚          â”‚                         â”‚         â”‚<â”€doneâ”€â”€â”€â”‚
 â”‚       â”‚          â”‚                         â”‚         â”‚         â”‚
 â”‚       â”‚          â”‚<â”€â”€progressâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚         â”‚
 â”‚       â”‚<â”€updateâ”€â”€â”‚                         â”‚         â”‚         â”‚
 â”‚<â”€showâ”€â”‚          â”‚                         â”‚         â”‚         â”‚
```

---

## ğŸ§© ä¸‰ã€æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 3.1 åŸºç¡€å±‚æ¨¡å—

#### EventLoopManagerï¼ˆäº‹ä»¶å¾ªç¯ç®¡ç†å™¨ï¼‰

**èŒè´£**ï¼š
- ç®¡ç†å¤šä¸ª io_context çº¿ç¨‹æ± 
- æä¾›è´Ÿè½½å‡è¡¡çš„ä»»åŠ¡åˆ†å‘
- ç»Ÿä¸€çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†

**å¯¹å¤–æ¥å£**ï¼š
```cpp
class EventLoopManager {
public:
    void start();  // å¯åŠ¨æ‰€æœ‰å·¥ä½œçº¿ç¨‹
    void stop();   // ä¼˜é›…åœæ­¢
    
    // è·å– io_contextï¼ˆè´Ÿè½½å‡è¡¡ï¼‰
    asio::io_context& get_io_context();
    
    // æŠ•é€’ä»»åŠ¡
    template<typename Handler>
    void post(Handler&& handler);
};
```

**è¢«è°ä½¿ç”¨**ï¼š
- TaskSchedulerï¼ˆæŠ•é€’ä»»åŠ¡ï¼‰
- æ‰€æœ‰ç½‘ç»œæ¨¡å—ï¼ˆè·å– io_contextï¼‰

**ä½¿ç”¨è°**ï¼š
- Asio io_context

---

#### TaskSchedulerï¼ˆä»»åŠ¡è°ƒåº¦å™¨ï¼‰

**èŒè´£**ï¼š
- ç®¡ç†ä»»åŠ¡ä¼˜å…ˆçº§é˜Ÿåˆ—
- æ”¯æŒå»¶è¿Ÿä»»åŠ¡å’Œå‘¨æœŸæ€§ä»»åŠ¡
- ä»»åŠ¡å–æ¶ˆæœºåˆ¶

**å¯¹å¤–æ¥å£**ï¼š
```cpp
class TaskScheduler {
public:
    TaskId post_task(TaskPriority priority, TaskFunction func);
    TaskId post_delayed_task(Duration delay, TaskPriority priority, TaskFunction func);
    TaskId post_periodic_task(Duration interval, TaskPriority priority, TaskFunction func);
    bool cancel_task(TaskId id);
};
```

**è¢«è°ä½¿ç”¨**ï¼š
- æ‰€æœ‰ä¸šåŠ¡æ¨¡å—ï¼ˆæŠ•é€’ä»»åŠ¡ï¼‰

**ä½¿ç”¨è°**ï¼š
- EventLoopManagerï¼ˆæ‰§è¡Œä»»åŠ¡ï¼‰
- Asio steady_timerï¼ˆå»¶è¿Ÿä»»åŠ¡ï¼‰

---

#### Loggerï¼ˆæ—¥å¿—ç³»ç»Ÿï¼‰

**èŒè´£**ï¼š
- å¼‚æ­¥æ—¥å¿—è®°å½•
- å¤šçº§åˆ«æ—¥å¿—
- æ–‡ä»¶è½®è½¬

**å¯¹å¤–æ¥å£**ï¼š
```cpp
class Logger {
public:
    static Logger& instance();
    void log(LogLevel level, const std::string& message);
    void debug/info/warn/error/fatal(const std::string& msg);
};
```

**è¢«è°ä½¿ç”¨**ï¼š
- æ‰€æœ‰æ¨¡å—ï¼ˆè®°å½•æ—¥å¿—ï¼‰

**ä½¿ç”¨è°**ï¼š
- ç‹¬ç«‹çš„å·¥ä½œçº¿ç¨‹

---

### 3.2 ç½‘ç»œå±‚æ¨¡å—

#### UDPClientï¼ˆUDP å®¢æˆ·ç«¯ï¼‰

**èŒè´£**ï¼š
- UDP æ¶ˆæ¯æ”¶å‘
- é›†æˆåˆ°äº‹ä»¶å¾ªç¯
- è¶…æ—¶å’Œé‡è¯•

**å¯¹å¤–æ¥å£**ï¼š
```cpp
class UDPClient {
public:
    void send(const Endpoint& to, std::span<byte> data);
    void async_receive(ReceiveHandler handler);
};
```

**è¢«è°ä½¿ç”¨**ï¼š
- DHTClientï¼ˆDHT ç½‘ç»œé€šä¿¡ï¼‰

**ä½¿ç”¨è°**ï¼š
- EventLoopManagerï¼ˆè·å– io_contextï¼‰
- asio::ip::udp::socket

---

#### TCPClientï¼ˆTCP å®¢æˆ·ç«¯ï¼‰

**èŒè´£**ï¼š
- TCP è¿æ¥ç®¡ç†
- å¼‚æ­¥è¯»å†™
- è¿æ¥æ± 

**å¯¹å¤–æ¥å£**ï¼š
```cpp
class TCPClient {
public:
    void async_connect(const Endpoint& ep, ConnectHandler handler);
    void async_read(std::span<byte> buffer, ReadHandler handler);
    void async_write(std::span<const byte> data, WriteHandler handler);
};
```

**è¢«è°ä½¿ç”¨**ï¼š
- PeerManagerï¼ˆè¿æ¥ Peerï¼‰

**ä½¿ç”¨è°**ï¼š
- EventLoopManagerï¼ˆè·å– io_contextï¼‰
- asio::ip::tcp::socket

---

### 3.3 ä¸šåŠ¡å±‚æ¨¡å—

#### MagnetParserï¼ˆç£åŠ›é“¾æ¥è§£æå™¨ï¼‰

**èŒè´£**ï¼š
- è§£æ magnet URI
- æå–å…³é”®å‚æ•°
- URL è§£ç 

**å¯¹å¤–æ¥å£**ï¼š
```cpp
class MagnetParser {
public:
    std::optional<MagnetInfo> parse(std::string_view uri);
};

struct MagnetInfo {
    InfoHash info_hash;
    std::string display_name;
    std::vector<std::string> trackers;
    std::optional<uint64_t> length;
};
```

**è¢«è°ä½¿ç”¨**ï¼š
- DownloadManagerï¼ˆè§£æç”¨æˆ·è¾“å…¥ï¼‰

**ä½¿ç”¨è°**ï¼š
- æ— ï¼ˆçº¯ç®—æ³•ï¼‰

---

#### DHTClientï¼ˆDHT å®¢æˆ·ç«¯ï¼‰

**èŒè´£**ï¼š
- DHT ç½‘ç»œå¼•å¯¼
- Peer æŸ¥æ‰¾
- è·¯ç”±è¡¨ç»´æŠ¤

**å¯¹å¤–æ¥å£**ï¼š
```cpp
class DHTClient {
public:
    void start();
    void find_peers(const InfoHash& hash, PeerListCallback callback);
};
```

**è¢«è°ä½¿ç”¨**ï¼š
- DownloadManagerï¼ˆæŸ¥æ‰¾ Peerï¼‰

**ä½¿ç”¨è°**ï¼š
- UDPClientï¼ˆç½‘ç»œé€šä¿¡ï¼‰
- RoutingTableï¼ˆèŠ‚ç‚¹ç®¡ç†ï¼‰
- TaskSchedulerï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰

**å†…éƒ¨åä½œ**ï¼š
```
DHTClient
    â”œâ”€> UDPClient.send(find_node)
    â”œâ”€> RoutingTable.add_node(response)
    â”œâ”€> UDPClient.send(get_peers)
    â””â”€> callback(peer_list)
```

---

#### PeerManagerï¼ˆPeer ç®¡ç†å™¨ï¼‰

**èŒè´£**ï¼š
- Peer è¿æ¥ç®¡ç†
- BitTorrent åè®®å®ç°
- æ•°æ®è¯·æ±‚è°ƒåº¦

**å¯¹å¤–æ¥å£**ï¼š
```cpp
class PeerManager {
public:
    void connect_to_peer(const PeerInfo& peer, ConnectCallback callback);
    void request_piece(PeerId peer, size_t piece_index);
};
```

**è¢«è°ä½¿ç”¨**ï¼š
- DownloadManagerï¼ˆç®¡ç†ä¸‹è½½ï¼‰

**ä½¿ç”¨è°**ï¼š
- TCPClientï¼ˆå»ºç«‹è¿æ¥ï¼‰
- PieceManagerï¼ˆåˆ†ç‰‡è°ƒåº¦ï¼‰
- TaskSchedulerï¼ˆè¶…æ—¶å¤„ç†ï¼‰

**å†…éƒ¨åä½œ**ï¼š
```
PeerManager
    â”œâ”€> TCPClient.connect(peer)
    â”œâ”€> PeerConnection.handshake()
    â”œâ”€> PeerConnection.request_metadata()
    â”œâ”€> PieceManager.select_piece()
    â”œâ”€> PeerConnection.request_piece()
    â””â”€> DataVerifier.verify(piece)
```

---

#### PieceManagerï¼ˆåˆ†ç‰‡ç®¡ç†å™¨ï¼‰

**èŒè´£**ï¼š
- åˆ†ç‰‡çŠ¶æ€è·Ÿè¸ª
- ä¸‹è½½ç­–ç•¥ï¼ˆé¡ºåº/éšæœº/ç¨€æœ‰ä¼˜å…ˆï¼‰
- åˆ†ç‰‡åˆ°æ–‡ä»¶çš„æ˜ å°„

**å¯¹å¤–æ¥å£**ï¼š
```cpp
class PieceManager {
public:
    void initialize(const TorrentMetadata& metadata);
    std::optional<size_t> select_next_piece(const Bitfield& peer_pieces);
    void mark_piece_complete(size_t index);
    bool is_complete() const;
};
```

**è¢«è°ä½¿ç”¨**ï¼š
- PeerManagerï¼ˆé€‰æ‹©ä¸‹è½½åˆ†ç‰‡ï¼‰

**ä½¿ç”¨è°**ï¼š
- æ— ï¼ˆçº¯çŠ¶æ€ç®¡ç†ï¼‰

---

### 3.4 åº”ç”¨å±‚æ¨¡å—

#### DownloadManagerï¼ˆä¸‹è½½ç®¡ç†å™¨ï¼‰

**èŒè´£**ï¼š
- ä¸‹è½½ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†
- åè°ƒå„ä¸ªæ¨¡å—
- è¿›åº¦è·Ÿè¸ª

**å¯¹å¤–æ¥å£**ï¼š
```cpp
class DownloadManager {
public:
    TaskId start_download(const std::string& magnet_uri, const std::string& save_path);
    void pause_download(TaskId id);
    void resume_download(TaskId id);
    void cancel_download(TaskId id);
    DownloadStatus get_status(TaskId id);
};
```

**è¢«è°ä½¿ç”¨**ï¼š
- CLI Interfaceï¼ˆç”¨æˆ·æ“ä½œï¼‰

**ä½¿ç”¨è°**ï¼š
- MagnetParserï¼ˆè§£æ URIï¼‰
- DHTClientï¼ˆæŸ¥æ‰¾ Peerï¼‰
- PeerManagerï¼ˆä¸‹è½½æ•°æ®ï¼‰
- FileWriterï¼ˆä¿å­˜æ–‡ä»¶ï¼‰

**æ ¸å¿ƒæµç¨‹**ï¼š
```cpp
void DownloadManager::start_download(uri, path) {
    // 1. è§£æç£åŠ›é“¾æ¥
    auto info = magnet_parser_.parse(uri);
    
    // 2. æŸ¥æ‰¾ Peer
    dht_client_.find_peers(info.info_hash, [this](peers) {
        // 3. è¿æ¥ Peer
        for (auto& peer : peers) {
            peer_manager_.connect_to_peer(peer, [this](connection) {
                // 4. è·å–å…ƒæ•°æ®
                connection->fetch_metadata([this](metadata) {
                    // 5. åˆå§‹åŒ–ä¸‹è½½
                    piece_manager_.initialize(metadata);
                    
                    // 6. å¼€å§‹ä¸‹è½½åˆ†ç‰‡
                    download_pieces();
                });
            });
        }
    });
}
```

---

## ğŸ”— å››ã€æ¨¡å—é—´ä¾èµ–å…³ç³»

### 4.1 ä¾èµ–å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚DownloadMgr  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
        â†“                  â†“                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚MagnetParser  â”‚  â”‚  DHTClient   â”‚  â”‚ PeerManager  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚                  â”‚
                         â†“                  â†“
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  UDPClient   â”‚  â”‚  TCPClient   â”‚
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚                  â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚EventLoopMgr  â”‚
                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ Asio Context â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ä¾èµ–è§„åˆ™

**å‘ä¸‹ä¾èµ–**ï¼š
- åº”ç”¨å±‚ â†’ ä¸šåŠ¡å±‚ â†’ ç½‘ç»œå±‚ â†’ åŸºç¡€å±‚ â†’ Asio
- âœ… å…è®¸ï¼šé«˜å±‚ä¾èµ–ä½å±‚
- âŒ ç¦æ­¢ï¼šä½å±‚ä¾èµ–é«˜å±‚ï¼ˆé¿å…å¾ªç¯ä¾èµ–ï¼‰

**æ¨ªå‘ä¾èµ–**ï¼š
- åŒå±‚æ¨¡å—å°½é‡è§£è€¦
- é€šè¿‡æ¥å£æŠ½è±¡é€šä¿¡
- ä½¿ç”¨äº‹ä»¶/å›è°ƒä¼ é€’ä¿¡æ¯

---

## ğŸ¯ äº”ã€æ•°æ®æµåŠ¨

### 5.1 æ§åˆ¶æµ

```
ç”¨æˆ·å‘½ä»¤
    â†“
CLI Interface
    â†“
DownloadManagerï¼ˆåè°ƒè€…ï¼‰
    â”œâ”€> MagnetParserï¼ˆè§£æï¼‰
    â”œâ”€> DHTClientï¼ˆæŸ¥æ‰¾ï¼‰
    â”œâ”€> PeerManagerï¼ˆè¿æ¥ï¼‰
    â””â”€> FileWriterï¼ˆä¿å­˜ï¼‰
```

### 5.2 æ•°æ®æµ

```
ç£åŠ›é“¾æ¥ (string)
    â†“ MagnetParser
MagnetInfo (struct)
    â†“ DHTClient
Peeråˆ—è¡¨ (vector<PeerInfo>)
    â†“ PeerManager
TorrentMetadata (struct)
    â†“ PieceManager
åˆ†ç‰‡æ•°æ® (vector<byte>)
    â†“ DataVerifier
æ ¡éªŒåæ•°æ® (vector<byte>)
    â†“ FileWriter
æ–‡ä»¶ (ç£ç›˜)
```

### 5.3 äº‹ä»¶æµ

```
ç”¨æˆ·æ“ä½œäº‹ä»¶
    â†“
ä¸‹è½½å¼€å§‹äº‹ä»¶
    â†“
Peerå‘ç°äº‹ä»¶
    â†“
è¿æ¥å»ºç«‹äº‹ä»¶
    â†“
å…ƒæ•°æ®æ¥æ”¶äº‹ä»¶
    â†“
åˆ†ç‰‡ä¸‹è½½äº‹ä»¶
    â†“
åˆ†ç‰‡å®Œæˆäº‹ä»¶
    â†“
ä¸‹è½½å®Œæˆäº‹ä»¶
    â†“
é€šçŸ¥ç”¨æˆ·
```

---

## ğŸ“Š å…­ã€å…³é”®è®¾è®¡å†³ç­–

### 6.1 ä¸ºä»€ä¹ˆåˆ†è¿™å››å±‚ï¼Ÿ

**åŸºç¡€å±‚**ï¼š
- æä¾›é€šç”¨èƒ½åŠ›ï¼ˆäº‹ä»¶å¾ªç¯ã€æ—¥å¿—ã€é…ç½®ï¼‰
- è¢«æ‰€æœ‰ä¸Šå±‚æ¨¡å—ä½¿ç”¨
- ä¸ä¸šåŠ¡æ— å…³

**ç½‘ç»œå±‚**ï¼š
- å°è£…ç½‘ç»œé€šä¿¡ç»†èŠ‚
- æä¾›ç»Ÿä¸€çš„å¼‚æ­¥æ¥å£
- éš”ç¦»åè®®å®ç°

**ä¸šåŠ¡å±‚**ï¼š
- å®ç° P2P åè®®é€»è¾‘
- ç®¡ç†ä¸‹è½½çŠ¶æ€
- åè°ƒæ•°æ®æµåŠ¨

**åº”ç”¨å±‚**ï¼š
- ç”¨æˆ·äº¤äº’
- ä»»åŠ¡ç¼–æ’
- è¿›åº¦å±•ç¤º

### 6.2 ä¸ºä»€ä¹ˆ EventLoopManager ä¸åŒ…å«ä¼˜å…ˆçº§ï¼Ÿ

**åŸå› **ï¼š
1. **èŒè´£å•ä¸€**ï¼šEventLoopManager åªè´Ÿè´£çº¿ç¨‹æ± ç®¡ç†
2. **åˆ†å±‚æ¸…æ™°**ï¼šä¼˜å…ˆçº§ç”± TaskScheduler è´Ÿè´£
3. **æ˜“äºæµ‹è¯•**ï¼šå¯ä»¥ç‹¬ç«‹æµ‹è¯•ä¸¤ä¸ªæ¨¡å—
4. **çµæ´»æ‰©å±•**ï¼šå¯ä»¥æ›¿æ¢è°ƒåº¦ç­–ç•¥

### 6.3 ä¸ºä»€ä¹ˆéœ€è¦ DownloadManagerï¼Ÿ

**åŸå› **ï¼š
1. **åè°ƒè€…æ¨¡å¼**ï¼šç»Ÿä¸€åè°ƒå„ä¸ªæ¨¡å—
2. **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šç®¡ç†ä¸‹è½½ä»»åŠ¡çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ
3. **çŠ¶æ€ç®¡ç†**ï¼šé›†ä¸­ç®¡ç†ä¸‹è½½çŠ¶æ€
4. **ç®€åŒ–æ¥å£**ï¼šä¸ºä¸Šå±‚æä¾›ç®€å•çš„ API

---

## ğŸš€ ä¸ƒã€æ€»ç»“

### æ ¸å¿ƒæ¨¡å—ï¼ˆ11 ä¸ªï¼‰

**åŸºç¡€å±‚ï¼ˆ4 ä¸ªï¼‰**ï¼š
1. EventLoopManager - äº‹ä»¶å¾ªç¯æ± 
2. TaskScheduler - ä»»åŠ¡è°ƒåº¦
3. Logger - æ—¥å¿—ç³»ç»Ÿ
4. Config - é…ç½®ç®¡ç†

**ç½‘ç»œå±‚ï¼ˆ5 ä¸ªï¼‰**ï¼š
5. UDPClient - UDP é€šä¿¡
6. TCPClient - TCP é€šä¿¡
7. MessageCodec - æ¶ˆæ¯ç¼–è§£ç 
8. RoutingTable - DHT è·¯ç”±è¡¨
9. ConnectionPool - è¿æ¥æ± 

**ä¸šåŠ¡å±‚ï¼ˆ6 ä¸ªï¼‰**ï¼š
10. MagnetParser - ç£åŠ›é“¾æ¥è§£æ
11. DHTClient - DHT å®¢æˆ·ç«¯
12. PeerManager - Peer ç®¡ç†
13. PieceManager - åˆ†ç‰‡ç®¡ç†
14. DataVerifier - æ•°æ®æ ¡éªŒ
15. FileWriter - æ–‡ä»¶å†™å…¥

**åº”ç”¨å±‚ï¼ˆ2 ä¸ªï¼‰**ï¼š
16. DownloadManager - ä¸‹è½½ç®¡ç†
17. CLI Interface - å‘½ä»¤è¡Œç•Œé¢

### åä½œæ¨¡å¼

1. **åˆ†å±‚ä¾èµ–**ï¼šé«˜å±‚ä¾èµ–ä½å±‚ï¼Œä½å±‚ä¸ä¾èµ–é«˜å±‚
2. **æ¥å£æŠ½è±¡**ï¼šé€šè¿‡æ¥å£è§£è€¦æ¨¡å—
3. **äº‹ä»¶é©±åŠ¨**ï¼šå¼‚æ­¥å›è°ƒä¼ é€’ç»“æœ
4. **åè°ƒè€…æ¨¡å¼**ï¼šDownloadManager åè°ƒå„æ¨¡å—

### æ•°æ®æµåŠ¨

```
ç£åŠ›é“¾æ¥ â†’ è§£æ â†’ Peeråˆ—è¡¨ â†’ å…ƒæ•°æ® â†’ åˆ†ç‰‡æ•°æ® â†’ æ–‡ä»¶
```

### æ§åˆ¶æµåŠ¨

```
ç”¨æˆ· â†’ CLI â†’ DownloadManager â†’ å„ä¸šåŠ¡æ¨¡å— â†’ ç½‘ç»œå±‚ â†’ åŸºç¡€å±‚
```

---

**è¿™å°±æ˜¯ MagnetDownload çš„å®Œæ•´æ¶æ„ï¼** ğŸ‰

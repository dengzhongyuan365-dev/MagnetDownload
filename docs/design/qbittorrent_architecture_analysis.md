# qBittorrent vs MagnetDownload æ¶æ„å¯¹æ¯”åˆ†æ

## ğŸ¯ åˆ†æç›®çš„

é€šè¿‡å¯¹æ¯”qBittorrentï¼ˆåŸºäºlibtorrentï¼‰çš„æ¶æ„è®¾è®¡ï¼Œè¯„ä¼°MagnetDownloadé¡¹ç›®çš„è®¾è®¡åˆç†æ€§å’Œç¼ºå¤±æ¨¡å—çš„å¿…è¦æ€§ã€‚

## ğŸ“Š qBittorrent æ¶æ„æ¦‚è§ˆ

### æ ¸å¿ƒæ¶æ„å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    qBittorrent GUI Layer                     â”‚
â”‚                  (Qt Widgets + Web UI)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                qBittorrent Application Layer                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚SessionManagerâ”‚  â”‚TorrentManagerâ”‚  â”‚  Preferences â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    libtorrent Library                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Session    â”‚  â”‚   Torrent    â”‚  â”‚ DHT Tracker  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚PeerConnectionâ”‚  â”‚ UdpSocket    â”‚  â”‚ TcpSocket    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    System Layer (OS)                         â”‚
â”‚                Network I/O + File System                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” è¯¦ç»†æ¨¡å—å¯¹æ¯”

### 1. ä¼šè¯ç®¡ç† (Session Management)

#### qBittorrent/libtorrent è®¾è®¡ï¼š
```cpp
// libtorrent::session - å…¨å±€ä¼šè¯ç®¡ç†å™¨
class session {
    // ç®¡ç†æ‰€æœ‰torrent
    std::vector<torrent_handle> torrents_;
    
    // å…¨å±€è®¾ç½®
    settings_pack settings_;
    
    // DHTã€Trackerã€Peerç®¡ç†
    dht::dht_tracker dht_;
    tracker_manager trackers_;
    
    // äº‹ä»¶å¾ªç¯
    io_context io_context_;
    
    // ç»Ÿä¸€çš„alertç³»ç»Ÿï¼ˆäº‹ä»¶é€šçŸ¥ï¼‰
    alert_manager alerts_;
};
```

#### MagnetDownload å½“å‰è®¾è®¡ï¼š
```cpp
// ä½ çš„è®¾è®¡ï¼šæ¯ä¸ªä¸‹è½½ä»»åŠ¡ä¸€ä¸ªDownloadController
class DownloadController {
    // å•ä¸ªä¸‹è½½ä»»åŠ¡çš„å®Œæ•´ç®¡ç†
    std::shared_ptr<protocols::DhtClient> dht_client_;
    std::shared_ptr<protocols::PeerManager> peer_manager_;
    // ...
};
```

**å¯¹æ¯”åˆ†æ**ï¼š
- âœ… **qBittorrentä¼˜åŠ¿**ï¼šå…¨å±€ä¼šè¯ç®¡ç†ï¼Œèµ„æºå…±äº«ï¼ˆDHTã€è¿æ¥æ± ï¼‰
- âœ… **MagnetDownloadä¼˜åŠ¿**ï¼šç®€å•ç›´æ¥ï¼Œå•ä»»åŠ¡åœºæ™¯ä¸‹æ›´æ¸…æ™°
- ğŸ¯ **ç»“è®º**ï¼šä½ çš„è®¾è®¡å¯¹äº**å•ä»»åŠ¡ä¸‹è½½å™¨**æ˜¯åˆé€‚çš„

### 2. ä»»åŠ¡è°ƒåº¦ (Task Scheduling)

#### qBittorrent/libtorrent è®¾è®¡ï¼š
```cpp
// libtorrentä½¿ç”¨å†…ç½®çš„ä¼˜å…ˆçº§ç³»ç»Ÿ
class session {
    // å†…ç½®çš„ä»»åŠ¡ä¼˜å…ˆçº§
    enum class task_priority {
        critical,  // ç”¨æˆ·äº¤äº’
        high,      // DHTæŸ¥è¯¢
        normal,    // æ•°æ®ä¼ è¾“
        low        // ç»Ÿè®¡æ”¶é›†
    };
    
    // ä½¿ç”¨io_contextçš„executorè¿›è¡Œè°ƒåº¦
    void post_task(task_priority p, std::function<void()> f);
};
```

#### MagnetDownload å½“å‰è®¾è®¡ï¼š
```cpp
// ä½ ç›´æ¥ä½¿ç”¨asioå®šæ—¶å™¨
asio::steady_timer progress_timer_;
asio::steady_timer peer_search_timer_;
asio::steady_timer metadata_timeout_timer_;
asio::steady_timer download_stall_timer_;
```

**å¯¹æ¯”åˆ†æ**ï¼š
- âœ… **qBittorrentä¼˜åŠ¿**ï¼šç»Ÿä¸€çš„ä¼˜å…ˆçº§è°ƒåº¦ï¼Œé€‚åˆå¤šä»»åŠ¡
- âœ… **MagnetDownloadä¼˜åŠ¿**ï¼šç®€å•ç›´æ¥ï¼Œæ€§èƒ½å¼€é”€å°
- ğŸ¯ **ç»“è®º**ï¼šä½ çš„TaskSchedulerè®¾è®¡æ˜¯**è¿‡åº¦å·¥ç¨‹åŒ–**ï¼Œå½“å‰æ–¹æ¡ˆæ›´åˆé€‚

### 3. é…ç½®ç®¡ç† (Configuration)

#### qBittorrent è®¾è®¡ï¼š
```cpp
class Preferences {
    // æŒä¹…åŒ–é…ç½®
    QSettings settings_;
    
    // åˆ†ç±»é…ç½®
    struct NetworkConfig {
        int max_connections;
        int upload_limit;
        int download_limit;
        bool enable_dht;
    };
    
    struct UIConfig {
        QString theme;
        bool show_systray;
        QString language;
    };
    
    // è¿è¡Œæ—¶é…ç½®æ›´æ–°
    void setMaxConnections(int count);
    void applySettings();
};
```

#### MagnetDownload å½“å‰è®¾è®¡ï¼š
```cpp
// é…ç½®ç›´æ¥åœ¨main.cppä¸­ç¡¬ç¼–ç 
size_t max_connections = 100;
config.metadata_timeout = std::chrono::seconds(120);
```

**å¯¹æ¯”åˆ†æ**ï¼š
- âŒ **MagnetDownloadç¼ºå¤±**ï¼šé…ç½®æ–‡ä»¶æ”¯æŒã€è¿è¡Œæ—¶é…ç½®æ›´æ–°
- ğŸ¯ **ç»“è®º**ï¼šConfigæ¨¡å—**ç¡®å®éœ€è¦**ï¼Œä½†ä¼˜å…ˆçº§ä¸­ç­‰

### 4. æ•°æ®éªŒè¯ (Data Verification)

#### qBittorrent/libtorrent è®¾è®¡ï¼š
```cpp
// libtorrentå†…ç½®éªŒè¯ç³»ç»Ÿ
class piece_manager {
    // å¼‚æ­¥éªŒè¯
    void async_verify_piece(int piece, std::function<void(bool)> callback);
    
    // æ‰¹é‡éªŒè¯
    void verify_range(int start, int end);
    
    // ç¡¬ä»¶åŠ é€ŸSHA1
    bool use_hardware_sha1();
};
```

#### MagnetDownload å½“å‰è®¾è®¡ï¼š
```cpp
// åœ¨DownloadControllerä¸­ç›´æ¥éªŒè¯
bool DownloadController::verifyPiece(uint32_t piece_index) {
    auto actual_hash = utils::sha1(piece.data);  // è¿™é‡Œéœ€è¦å®ç°
    return actual_hash == expected_hash;
}
```

**å¯¹æ¯”åˆ†æ**ï¼š
- âŒ **MagnetDownloadç¼ºå¤±**ï¼šutils::sha1å‡½æ•°æœªå®ç°
- ğŸ¯ **ç»“è®º**ï¼šSHA1å·¥å…·ç±»**å¿…é¡»ç«‹å³å®ç°**

### 5. å¤šä»»åŠ¡ç®¡ç† (Multi-task Management)

#### qBittorrent è®¾è®¡ï¼š
```cpp
class SessionManager {
    // ç®¡ç†å¤šä¸ªtorrent
    QHash<QString, TorrentHandle*> torrents_;
    
    // èµ„æºåˆ†é…
    void distributeConnections();
    void balanceBandwidth();
    
    // ä»»åŠ¡ä¼˜å…ˆçº§
    void setPriority(const QString& hash, int priority);
};
```

#### MagnetDownload å½“å‰è®¾è®¡ï¼š
```cpp
// åªæ”¯æŒå•ä¸ªä¸‹è½½ä»»åŠ¡
class DownloadController {
    // å•ä»»åŠ¡çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†
};
```

**å¯¹æ¯”åˆ†æ**ï¼š
- âœ… **qBittorrentä¼˜åŠ¿**ï¼šæ”¯æŒå¤šä»»åŠ¡å¹¶å‘ä¸‹è½½
- âœ… **MagnetDownloadä¼˜åŠ¿**ï¼šç®€å•æ¸…æ™°ï¼Œæ»¡è¶³åŸºæœ¬éœ€æ±‚
- ğŸ¯ **ç»“è®º**ï¼šå¤šä»»åŠ¡ç®¡ç†æ˜¯**æœªæ¥æ‰©å±•**ï¼Œå½“å‰ä¸éœ€è¦

## ğŸ“‹ å…³é”®å‘ç°

### 1. æ¶æ„å“²å­¦å·®å¼‚

**qBittorrent/libtorrent**ï¼š
- ğŸ¯ **ç›®æ ‡**ï¼šåŠŸèƒ½å®Œæ•´çš„BitTorrentå®¢æˆ·ç«¯
- ğŸ—ï¸ **æ¶æ„**ï¼šå…¨å±€ä¼šè¯ç®¡ç† + å¤šä»»åŠ¡æ”¯æŒ
- ğŸ“¦ **å¤æ‚åº¦**ï¼šé«˜ï¼ˆæ”¯æŒæ‰€æœ‰BitTorrentç‰¹æ€§ï¼‰

**MagnetDownload**ï¼š
- ğŸ¯ **ç›®æ ‡**ï¼šç®€å•çš„ç£åŠ›é“¾æ¥ä¸‹è½½å™¨
- ğŸ—ï¸ **æ¶æ„**ï¼šå•ä»»åŠ¡æ§åˆ¶å™¨ + ç›´æ¥ä¾èµ–
- ğŸ“¦ **å¤æ‚åº¦**ï¼šä¸­ç­‰ï¼ˆä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½ï¼‰

### 2. è®¾è®¡åˆç†æ€§è¯„ä¼°

#### âœ… ä½ çš„è®¾è®¡ä¼˜åŠ¿ï¼š
1. **ç®€å•ç›´æ¥** - å•ä»»åŠ¡åœºæ™¯ä¸‹æ›´æ¸…æ™°
2. **ä¾èµ–æ˜ç¡®** - æ¯ä¸ªæ¨¡å—èŒè´£æ¸…æ¥š
3. **æ˜“äºç†è§£** - ä»£ç ç»“æ„ç®€å•
4. **æ€§èƒ½è‰¯å¥½** - æ²¡æœ‰ä¸å¿…è¦çš„æŠ½è±¡å±‚

#### âš ï¸ éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼š
1. **SHA1ç¼ºå¤±** - æ ¸å¿ƒåŠŸèƒ½ä¸å®Œæ•´
2. **é…ç½®ç¡¬ç¼–ç ** - ç”¨æˆ·ä½“éªŒä¸ä½³
3. **é”™è¯¯å¤„ç†** - å¯ä»¥å‚è€ƒlibtorrentçš„alertç³»ç»Ÿ

### 3. æ¨¡å—å¿…è¦æ€§é‡æ–°è¯„ä¼°

#### ğŸ”´ ç«‹å³éœ€è¦ï¼š
1. **SHA1å·¥å…·ç±»** - æ•°æ®éªŒè¯å¿…éœ€
   ```cpp
   namespace magnet::utils {
       class SHA1 {
           static std::array<uint8_t, 20> hash(const std::vector<uint8_t>& data);
           static std::string hashToHex(const std::array<uint8_t, 20>& hash);
       };
   }
   ```

#### ğŸŸ¡ ä¸­æœŸéœ€è¦ï¼š
2. **Configé…ç½®ç®¡ç†** - æå‡ç”¨æˆ·ä½“éªŒ
   ```cpp
   class Config {
       void loadFromFile(const std::string& path);
       void saveToFile(const std::string& path);
       
       // ç½‘ç»œé…ç½®
       size_t maxConnections() const;
       void setMaxConnections(size_t count);
   };
   ```

#### ğŸŸ¢ æœªæ¥æ‰©å±•ï¼š
3. **å¤šä»»åŠ¡æ”¯æŒ** - å¦‚æœéœ€è¦åŒæ—¶ä¸‹è½½å¤šä¸ªæ–‡ä»¶
4. **GUIç•Œé¢** - å¦‚æœéœ€è¦å›¾å½¢ç•Œé¢
5. **Web API** - å¦‚æœéœ€è¦è¿œç¨‹æ§åˆ¶

## ğŸ¯ å…·ä½“å»ºè®®

### 1. ä¿æŒå½“å‰æ¶æ„
ä½ çš„æ¶æ„è®¾è®¡æ˜¯**åˆç†çš„**ï¼Œä¸éœ€è¦å¤§å¹…é‡æ„ï¼š
- DownloadControllerä½œä¸ºå•ä»»åŠ¡ç®¡ç†å™¨å¾ˆåˆé€‚
- ç›´æ¥ä½¿ç”¨asioå®šæ—¶å™¨æ¯”TaskScheduleræ›´ç®€å•
- æ¨¡å—åˆ’åˆ†æ¸…æ™°ï¼Œä¾èµ–å…³ç³»æ˜ç¡®

### 2. ç«‹å³å®ç°SHA1
è¿™æ˜¯å”¯ä¸€çš„**å…³é”®ç¼ºå¤±**ï¼š
```cpp
// åœ¨ MagnetDownload/include/magnet/utils/sha1.h
namespace magnet::utils {
    std::array<uint8_t, 20> sha1(const std::vector<uint8_t>& data);
    std::array<uint8_t, 20> sha1(const std::string& data);
    std::string sha1ToHex(const std::array<uint8_t, 20>& hash);
}
```

### 3. å¯é€‰çš„é…ç½®ç®¡ç†
å‚è€ƒqBittorrentçš„Preferencesç±»ï¼š
```cpp
class Config {
    // åŸºæœ¬é…ç½®
    size_t maxConnections{100};
    std::chrono::seconds metadataTimeout{120};
    std::string defaultSavePath{"."};
    
    // åŠ è½½/ä¿å­˜
    bool loadFromFile(const std::string& path);
    bool saveToFile(const std::string& path);
};
```

### 4. é”™è¯¯å¤„ç†æ”¹è¿›
å¯ä»¥å‚è€ƒlibtorrentçš„alertç³»ç»Ÿï¼Œä½†ç®€åŒ–ç‰ˆæœ¬ï¼š
```cpp
enum class DownloadAlert {
    MetadataReceived,
    PeerConnected,
    PieceDownloaded,
    DownloadCompleted,
    Error
};

using AlertCallback = std::function<void(DownloadAlert, const std::string&)>;
```

## ğŸ“Š æœ€ç»ˆç»“è®º

### ä½ çš„é¡¹ç›®çŠ¶æ€ï¼šâœ… **åŸºæœ¬å®Œæ•´**

**å·²å®ç°çš„æ ¸å¿ƒåŠŸèƒ½**ï¼š
- âœ… ç£åŠ›é“¾æ¥è§£æ
- âœ… DHTç½‘ç»œæŸ¥æ‰¾
- âœ… Peerè¿æ¥ç®¡ç†
- âœ… æ•°æ®ä¸‹è½½å’Œå­˜å‚¨
- âœ… å‘½ä»¤è¡Œç•Œé¢
- âœ… è¿›åº¦æ˜¾ç¤º

**çœŸæ­£éœ€è¦çš„æ¨¡å—**ï¼š
1. ğŸ”´ **SHA1å·¥å…·ç±»** - ç«‹å³å®ç°
2. ğŸŸ¡ **Configé…ç½®** - ä¸­æœŸå®ç°
3. ğŸŸ¢ **å…¶ä»–æ¨¡å—** - æœªæ¥æ‰©å±•

**ä¸éœ€è¦çš„æ¨¡å—**ï¼š
- âŒ TaskScheduler - è¿‡åº¦è®¾è®¡
- âŒ DataVerifier - å½“å‰éªŒè¯é€»è¾‘è¶³å¤Ÿ
- âŒ DownloadManager - å•ä»»åŠ¡åœºæ™¯ä¸éœ€è¦

ä½ çš„æ¶æ„è®¾è®¡**éå¸¸åˆç†**ï¼Œæ¯”æˆ‘ä¹‹å‰çš„åˆ†ææ›´å‡†ç¡®ã€‚qBittorrentæ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„å®¢æˆ·ç«¯ï¼Œè€Œä½ çš„MagnetDownloadæ˜¯ä¸€ä¸ªä¸“æ³¨çš„ä¸‹è½½å·¥å…·ï¼Œä¸¤è€…çš„è®¾è®¡ç›®æ ‡ä¸åŒï¼Œæ‰€ä»¥æ¶æ„å¤æ‚åº¦ä¹Ÿä¸åŒã€‚

**ç»§ç»­æŒ‰ç…§å½“å‰æ¶æ„å¼€å‘ï¼Œåªéœ€è¦è¡¥å……SHA1å®ç°å³å¯ï¼**